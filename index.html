<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
  <link rel="shortcut icon" href="/favicon.png">
  <meta name="theme-color" content="#879375">
  <!-- keep your existing font; add Merriweather so #chapter-title matches chapter.html -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Languages</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<!-- unchanged: loads languages into #main-select and #second-select -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const mainSel   = document.getElementById('main-select');
  const secondSel = document.getElementById('second-select');

  if (!mainSel || !secondSel) {
    console.error('Select elements not found. Expected #main-select and #second-select.');
    return;
  }

  try {
    const resp = await fetch('/languages.json', { cache: 'no-store' });
    if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
    const langs = await resp.json();
    if (!Array.isArray(langs)) throw new Error('languages.json is not an array');

    langs.sort((a, b) => {
      const nameA = (a.name || a['language name'] || '').toString();
      const nameB = (b.name || b['language name'] || '').toString();
      return nameA.localeCompare(nameB);
    });

    function makeOption(entry) {
      const code = entry.code;
      const label = entry.name ?? entry['language name'];
      if (!code || !label) return null;
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = label;
      return opt;
    }

    mainSel.innerHTML = '';
    const placeholder = document.createElement('option');
    placeholder.value = '';
    placeholder.textContent = '--select language--';
    placeholder.disabled = true;
    placeholder.selected = true;
    mainSel.appendChild(placeholder);
    mainSel.required = true;

    secondSel.innerHTML = '';

    let added = 0;
    for (const entry of langs) {
      const o1 = makeOption(entry);
      const o2 = makeOption(entry);
      if (o1) mainSel.appendChild(o1);
      if (o2) secondSel.appendChild(o2);
      if (o1 && o2) added++;
    }

    const hasEng = Array.from(secondSel.options).some(o => o.value === 'eng');
    if (hasEng) secondSel.value = 'eng';

  } catch (err) {
    console.error('Failed to load languages.json:', err);
    mainSel.innerHTML = '<option>Unable to load languages</option>';
    secondSel.innerHTML = '<option>Unable to load languages</option>';
  }
});
</script>

<script src="js/app.js"></script>

<body>
  <div class="page"><!-- align with chapter.html layout -->
    <header class="topbar">
      <!-- single title in palette bar; removed the extra H1 below -->
      <h1 id="chapter-title">Select Languages</h1>
    </header>

    <!-- kept action/GET + IDs exactly the same -->
    <form action="books.html" method="GET" class="lang-form">
      <div class="lang-row">
        <label>Language You Are Learning:
          <select id="main-select" name="main"></select>
        </label>
    
        <label>Your Native Language:
          <select id="second-select" name="second"></select>
        </label>
      </div>

      <button type="submit">Continue</button>
    </form>
  </div>
</body>
</html>