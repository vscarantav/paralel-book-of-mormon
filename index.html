<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Languages</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Ensure these IDs exist in your HTML:
  // <select id="main-select" name="main"></select>
  // <select id="second-select" name="second"></select>
  const mainSel   = document.getElementById('main-select');
  const secondSel = document.getElementById('second-select');

  if (!mainSel || !secondSel) {
    console.error('Select elements not found. Expected #main-select and #second-select.');
    return;
  }

  try {
    const resp = await fetch('/languages.json', { cache: 'no-store' });
    if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
    const langs = await resp.json();

    if (!Array.isArray(langs)) throw new Error('languages.json is not an array');

    // Sort by display name
    langs.sort((a, b) => {
      const nameA = (a.name || a['language name'] || '').toString();
      const nameB = (b.name || b['language name'] || '').toString();
      return nameA.localeCompare(nameB);
    });

    // Helper to create an <option>
    function makeOption(entry) {
      // Support either { code, name } or { code, "language name" }
      const code = entry.code;
      const label = entry.name ?? entry['language name'];
      if (!code || !label) return null;
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = label;
      return opt;
    }

    // Placeholder for the first select (required)
    mainSel.innerHTML = '';
    const placeholder = document.createElement('option');
    placeholder.value = '';
    placeholder.textContent = '--select language--';
    placeholder.disabled = true;
    placeholder.selected = true;
    mainSel.appendChild(placeholder);
    mainSel.required = true;

    // Clear and populate both selects
    secondSel.innerHTML = '';

    let added = 0;
    for (const entry of langs) {
      const o1 = makeOption(entry);
      const o2 = makeOption(entry);
      if (o1) mainSel.appendChild(o1);
      if (o2) secondSel.appendChild(o2);
      if (o1 && o2) added++;
    }

    console.log(`Loaded ${langs.length} entries; appended ${added} options.`);

    // Optional: default the native language to English if present
    const hasEng = Array.from(secondSel.options).some(o => o.value === 'eng');
    if (hasEng) secondSel.value = 'eng';

  } catch (err) {
    console.error('Failed to load languages.json:', err);
    // Graceful fallback
    mainSel.innerHTML = '<option>Unable to load languages</option>';
    secondSel.innerHTML = '<option>Unable to load languages</option>';
  }
});
</script>

<body>
  <h1>Select Languages to Read the Book of Mormon</h1>
  <form action="books.html" method="GET" class="lang-form">
<label>Language You Are Learning:
  <select id="main-select" name="main"></select>
</label>

<label>Your Native Language:
  <select id="second-select" name="second"></select>
</label>
    <button type="submit">Continue</button>
  </form>
</body>
</html>
